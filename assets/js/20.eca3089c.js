(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{224:function(t,s,a){"use strict";a.r(s);var n=a(28),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"hello-world"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hello-world"}},[t._v("#")]),t._v(" Hello World")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#启动无头客户端"}},[t._v("启动无头客户端")]),a("ul",[a("li",[a("a",{attrs:{href:"#成功依照其指示启动后"}},[t._v("成功依照其指示启动后")])])])]),a("li",[a("a",{attrs:{href:"#安装-python-mirai"}},[t._v("安装 python-mirai")]),a("ul",[a("li",[a("a",{attrs:{href:"#从-pypi-安装"}},[t._v("从 Pypi 安装")])]),a("li",[a("a",{attrs:{href:"#从-github-源代码仓库安装"}},[t._v("从 Github 源代码仓库安装")])])])]),a("li",[a("a",{attrs:{href:"#hello-world"}},[t._v("Hello, world!")]),a("ul",[a("li",[a("a",{attrs:{href:"#发生了什么"}},[t._v("发生了什么?")])])])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"启动无头客户端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动无头客户端"}},[t._v("#")]),t._v(" 启动无头客户端")]),t._v(" "),a("p",[t._v("由于 "),a("code",[t._v("python-mirai")]),t._v(" 基于 "),a("code",[t._v("mirai-http-api")]),t._v(" 实现, 所以若你想通过 "),a("code",[t._v("python-mirai")]),t._v(" 编写机器人,\n我建议你先按照Mirai的"),a("a",{attrs:{href:"https://github.com/mamoe/mirai-console",target:"_blank",rel:"noopener noreferrer"}},[t._v("文档"),a("OutboundLink")],1),t._v("启动一个\n"),a("code",[t._v("mirai-console")]),t._v(" 实例, 然后按照其输出进行操作即可.")]),t._v(" "),a("h3",{attrs:{id:"成功依照其指示启动后"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#成功依照其指示启动后"}},[t._v("#")]),t._v(" 成功依照其指示启动后")]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("mirai-console.jar")]),t._v(" 同级目录下的文件夹 "),a("code",[t._v("plugins/MiraiAPIHTTP")]),t._v(" 下,\n会有一个 "),a("code",[t._v("setting.yml")]),t._v(" 文件, 文件内容可能如下:")]),t._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("APIKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" fafvasdfe4aht7iuklu\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("将字段 "),a("code",[t._v("APIKey")]),t._v(" 和 "),a("code",[t._v("port")]),t._v(" 的值记下, 然后下一步.")]),t._v(" "),a("h2",{attrs:{id:"安装-python-mirai"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-python-mirai"}},[t._v("#")]),t._v(" 安装 python-mirai")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("由于 "),a("code",[t._v("mirai")]),t._v(" 现在处于快速流转状态, 建议你在其结束前尽量使用来自仓库的源代码安装,\n以免导致接口不兼容的情况的发生.")])]),t._v(" "),a("h3",{attrs:{id:"从-pypi-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从-pypi-安装"}},[t._v("#")]),t._v(" 从 Pypi 安装")]),t._v(" "),a("p",[t._v("从 Pypi 安装是获取 "),a("code",[t._v("python-mirai")]),t._v(" 最快捷的方式, 通常情况下, 从该来源安装的包较从源代码仓库安装更稳定, 但可能不包括新的特性.")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" pip "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" kuriyama\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"从-github-源代码仓库安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从-github-源代码仓库安装"}},[t._v("#")]),t._v(" 从 Github 源代码仓库安装")]),t._v(" "),a("p",[t._v("从 Github 源代码仓库安装是获取 "),a("code",[t._v("python-mirai")]),t._v(" 最新特性与兼容的唯一方式,\n通常的, 我们会尽量使仓库下的 "),a("code",[t._v("test.py")]),t._v(" 文件可以被执行,\n但这并不包含其他未被使用的特性.")]),t._v(" "),a("p",[t._v("从该途径安装, 需要你先安装好 "),a("code",[t._v("git")]),t._v(", "),a("code",[t._v("setuptools")]),t._v(".")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/Chenwe-i-lin/python-mirai\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" python-mirai\n$ pip "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -r requirements.txt\n$ python setup.py "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("若你还没有学习过 Python 的标准库 "),a("code",[t._v("asyncio")]),t._v(" 的基本用法,\n或是因为没有接触过这方面的内容,\n所以自己无法理解接下来的内容,\n那么请"),a("strong",[t._v("不要")]),t._v("将自己的怒火发泄到开发者身上.")]),t._v(" "),a("blockquote",[a("p",[t._v("无知不是什么挡箭牌, 只有知识的渊博才能使人成为受人敬仰的对象.")])])]),t._v(" "),a("h2",{attrs:{id:"hello-world-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hello-world-2"}},[t._v("#")]),t._v(" Hello, world!")]),t._v(" "),a("p",[t._v("代码实现最简单的机器人如下所示, 我们使用了标准库 "),a("code",[t._v("typing")]),t._v(" 以获得更好的开发体验."),a("br"),t._v("\n在这里我们将假设你已经配置好了 "),a("code",[t._v("mirai-console")]),t._v(" 及 "),a("code",[t._v("mirai-http-api")]),t._v(",\n并获取到了必要的, 例如 "),a("code",[t._v("APIKey")]),t._v(", "),a("code",[t._v("port")]),t._v(", "),a("code",[t._v("qq")]),t._v(" 等关键配置...嗯, 你还记得你用来登录的机器人的qq号吗?\n等下要用, 字段 "),a("code",[t._v("qq")]),t._v(" 的值就是你用来登录的机器人的qq号.")]),t._v(" "),a("p",[t._v("这是一段代码样例, 当有用户私聊机器人时, 会向其发送一条 "),a("code",[t._v('"Hello, world!"')]),t._v(".\n出于使任何人理解的目的, 我会带着你一一解析我们提供的 API .")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("由于本文档更新时, "),a("code",[t._v("python-mirai")]),t._v(" 已经发布了 "),a("code",[t._v("0.2.1")]),t._v(",\n故我们将转为介绍 "),a("code",[t._v("Application")]),t._v(", 同时 "),a("code",[t._v("Session")]),t._v(" 将作为 "),a("code",[t._v("addForeverTarget")]),t._v(" 的备选方案.")])]),t._v(" "),a("p",[t._v("首先, 给出一段 "),a("code",[t._v("Hello, world!")]),t._v(" 代码:")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" mirai "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Mirai"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Plain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" MessageChain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Group\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" asyncio\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" environment "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    qq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 字段 qq 的值")]),t._v("\n    authKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 字段 authKey 的值")]),t._v("\n    mirai_api_http_locate "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# = f"{httpapi所在主机的IP, 需有效!}:{字段 port 的值}"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 上面是把我们之前记住的各种信息导入到程序中来, 属于伪代码,")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请不要在真实环境中填入!!!!!!")]),t._v("\n\napp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Mirai"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string-interpolation"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"mirai://')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("mirai_api_http_locate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("/ws?authKey=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("authKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("&qq=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("qq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("receiver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GroupMessage"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("event_gm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Mirai"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sendGroupMessage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        Plain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello, world!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"__main__"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("强烈建议你开一个测试机器人专用的群组, 否则你的机器人很可能会被其他人仇视!")]),t._v(" "),a("p",[t._v("在目前的版本中, "),a("code",[t._v("mirai-api-http")]),t._v(" 无法通过 http 轮询的方式获取信息,\n请使用 "),a("code",[t._v("WebSocket")]),t._v(" 方式, 只需要在 url 中使用 "),a("code",[t._v("/ws")]),t._v(" 代替之前的 "),a("code",[t._v("/")]),t._v(" 即可.")]),t._v(" "),a("p",[t._v("如果不使用 url 方式, 则将 "),a("code",[t._v("websocket")]),t._v(" 设为 "),a("code",[t._v("True")]),t._v(".")])]),t._v(" "),a("p",[t._v("运行这段代码, 在某个群随便说一句话, 你的机器人就会发送一条消息:")]),t._v(" "),a("panel-view",{attrs:{title:"聊天记录"}},[a("chat-message",{attrs:{nickname:"Alice",color:"#cc0066"}},[t._v("向这个世界问个好吧.")]),t._v(" "),a("chat-message",{attrs:{nickname:"Bot",avatar:t.$withBase("/mirai-head.png")}},[t._v("Hello, world!")])],1),t._v(" "),a("h3",{attrs:{id:"发生了什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发生了什么"}},[t._v("#")]),t._v(" 发生了什么?")]),t._v(" "),a("p",[t._v("我们会分几个章节来说明一个 "),a("code",[t._v("Hello, world")]),t._v(" 实例, 这里我们先介绍下 "),a("code",[t._v("Application")]),t._v(" 机制."),a("br"),t._v(" "),a("code",[t._v("Application")]),t._v(" 实例负责从无头客户端处获取消息/事件, 同时负责协调与执行事件.")]),t._v(" "),a("p",[t._v("首先, 我们从定义了 "),a("code",[t._v("app")]),t._v(" 的那行开始解析.")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("Mirai"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string-interpolation"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"mirai://localhost:8080/ws?authKey=')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("authKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("&qq=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("qq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("你可以很清晰的看出, 我们使用了一个 URL 实例化了一个 "),a("code",[t._v("Mirai")]),t._v(" 对象, 这是推荐的做法."),a("br"),t._v("\n如果你需要传入具名参数, 需要使用类似 "),a("code",[t._v("host")]),t._v(", "),a("code",[t._v("port")]),t._v(", "),a("code",[t._v("qq")]),t._v(" 之类的字段, 也是可以的:")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("Mirai"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8080"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" authKey"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("authKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qq"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("qq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" websocket"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("无论如何, 在实例中,\n我们最后都使用了 "),a("code",[t._v("Mirai.run")]),t._v(" 方法启动了 "),a("code",[t._v("Application")]),t._v(" 内部的相关机制,\n使一切开始运作起来.")]),t._v(" "),a("p",[t._v("到底发生了什么?")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("DETAILS")]),t._v(" "),a("p",[t._v("当执行方法 "),a("code",[t._v("Mirai.run")]),t._v(" 时:")]),t._v(" "),a("ul",[a("li",[t._v("我们向无头客户端发起认证, 获取并记录 "),a("code",[t._v("sessionKey")]),t._v(";")]),t._v(" "),a("li",[t._v("发起一次 "),a("code",[t._v("verify")]),t._v(" 请求, 绑定机器人的 qq;")]),t._v(" "),a("li",[t._v("开始信息/事件获取协程, 用于从无头服务器端获取事件广播并执行事件.")])])]),t._v(" "),a("p",[t._v("然后我们使用 "),a("code",[t._v("Mirai.receiver")]),t._v(" 注册了事件 "),a("code",[t._v('"GroupMessage"')]),t._v(".")]),t._v(" "),a("p",[t._v("当我们的短轮询协程从无头客户端获取到事件时,\n会对其广播的事件进行查找, 并运行事务.")]),t._v(" "),a("p",[t._v("于是当 "),a("code",[t._v("Application")]),t._v(" 获取到事件 "),a("code",[t._v('"GroupMessage"')]),t._v(" 时,\n"),a("code",[t._v("event_runner")]),t._v(" 从已注册的事件列表内抽出 "),a("code",[t._v("事件运行主体(Event Body)")]),t._v(",\n并传入 "),a("code",[t._v("上下文(Context)")]),t._v(" 运行事务.")]),t._v(" "),a("p",[t._v("简单来说, 就是:")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("注册事件 -> 监听事件 -> 收到事件 -> 传入上下文并运行\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("如果你理解了这些, 那么你就可以去浏览本文档的其他部分了.")])],1)}),[],!1,null,null,null);s.default=e.exports}}]);